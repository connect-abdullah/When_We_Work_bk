FROM python:3.12-alpine AS base

WORKDIR /app

# Install system dependencies
RUN apk add --no-cache gcc musl-dev curl

# Install poetry 
RUN pip install --upgrade pip && pip install poetry

# Configure poetry
RUN poetry config virtualenvs.create false

COPY poetry.lock pyproject.toml README.md ./

RUN poetry install --no-interaction --no-ansi --no-root

COPY . .

EXPOSE 8000
COPY scripts/script.sh ./scripts/script.sh

CMD ["/bin/sh", "scripts/script.sh"]`